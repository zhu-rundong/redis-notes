# 7.2 压缩列表节点的构成

压缩列表节点可以保存一个字节数组或者一个整数值，并且每个节点都由 `previous_entry_length` 、 `encoding` 、 `content` 三个部分组成，如下所示：

|previous_entry_length|encoding|content|
| -----------------------| ----------| ---------|

## previous_entry_length

节点的 `previous_entry_length`属性以字节为单位， 记录了压缩列表中前一个节点的长度，长度可以是 **1** 字节或者 **5** 字节：

* 如果前一节点的长度小于 **254** 字节， 那么 `previous_entry_length`属性的长度为 **1** 字节，且前一节点的长度就保存在这一个字节里面。
* 如果前一节点的长度大于等于 **254** 字节， 那么 `previous_entry_length`属性的长度为 **5** 字节，其中属性的第一字节会被设置为 **0xFE**（十进制值 **254**）， 而之后的四个字节则用于保存前一节点的长度。

因为节点的 `previous_entry_length`属性记录了前一个节点的长度， 那么我们就可以通过当前节点的起始地址减去当前节点 `<span previous_entry_length`属性的值，得到一个指向前一个节点起始地址的指针。

压缩列表的从表尾向表头遍历操作就是使用这一原理实现的， 通过某个节点的起始地址及这个节点 `<span previous_entry_length`属性的值，就一直向前一个节点回溯， 最终到达压缩列表的表头节点。

## encoding

节点的 `encoding` 属性记录了节点的 `content` 属性所保存数据的类型以及长度：

* 一字节、两字节或者五字节长， 值的最高位为 **00 、01 、10** 的是字节数组编码： 这种编码表示节点的 `content`属性保存着字节数组， 数组的长度由编码除去最高两位之后的其他位记录
* 一字节长， 值的最高位以 **11** 开头的是整数编码： 这种编码表示节点的`content`属性保存着整数值， 整数值的类型和长度由编码除去最高两位之后的其他位记录

**字节数组编码：**

|编码|编码长度|content 属性保存的值|
| ---------------------------------------------| ----------| ------------------------------------------------|
|00bbbbbb|1 字节|长度小于等于 63(2^6^-1) 字节的字节数组。|
|01bbbbbb xxxxxxxx|2 字节|长度小于等于 16383(2^14^-1) 字节的字节数组。|
|10______aaaaaaaa bbbbbbbb cccccccc dddddddd|5 字节|长度小于等于 4294967295(2^32^-1) 的字节数组。|

**整数编码：**

|编码|编码长度|content 属性保存的值|
| ----------| ----------| -----------------------------------------------------------------------------------------------------------------------------|
|11000000|1 字节|int16_t 类型的整数。|
|11010000|1 字节|int32_t 类型的整数。|
|11100000|1 字节|int64_t 类型的整数。|
|11110000|1 字节|24 位有符号整数。|
|11111110|1 字节|8 位有符号整数。|
|1111xxxx|1 字节|节点没有相应的 content 属性， 因为编码本身的 xxxx 四个位已经保存了一个介于 0 和 12 之间的值<br />， 所以它无须 content 属性。<br />|

## content

节点的 `content` 属性用来保存节点的值，节点值可以使字节数组或整数，值的类型和长度由`encoding`属性决定。

例如：

保存字节数组 "hello world" 的节点，其中编码的最高两位 00 表示节点保存的是一个字节数组，后六位 001011 记录了字节数组的长度 11 ，`content`属性保存着节点的值 **"hello world"**。

|previoid_entry_length|encoding|content|
| -----------------------| ----------| ---------------|
|...|00001011|"hello world"|

保存整数10086的节点，其中编码 11000000 表示节点保存的是一个 `int16_t` 类型的整数值，`content`属性保存着节点的值 **10086**。

|previoid_entry_length|encoding|content|
| -----------------------| ----------| ---------|
|...|11000000|10086|
